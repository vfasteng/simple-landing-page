{"version":3,"file":"aframe-websurfaces.umd.js","sources":["../src/lib/CSS3DRenderer.js","../src/constants.js","../src/DOMContext.js","../src/DOMElement.js","../src/websurface.js"],"sourcesContent":["/**\r\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\r\n */\r\n\r\nclass CSS3DObject extends THREE.Object3D {\r\n  constructor(element) {\r\n    super();\r\n\r\n    this.element = element || document.createElement('div');\r\n    this.element.style.position = 'absolute';\r\n    this.element.style.pointerEvents = 'auto';\r\n\r\n    this.addEventListener('removed', function () {\r\n      this.traverse(function (object) {\r\n        if (object.element instanceof Element && object.element.parentNode !== null) {\r\n          object.element.parentNode.removeChild(object.element);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  copy(source, recursive) {\r\n    super.copy(source, recursive);\r\n\r\n    this.element = source.element.cloneNode(true);\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nCSS3DObject.prototype.isCSS3DObject = true;\r\n\r\nclass CSS3DSprite extends CSS3DObject {\r\n  constructor(element) {\r\n    super(element);\r\n\r\n    this.rotation2D = 0;\r\n  }\r\n\r\n  copy(source, recursive) {\r\n    super.copy(source, recursive);\r\n\r\n    this.rotation2D = source.rotation2D;\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nCSS3DSprite.prototype.isCSS3DSprite = true;\r\n\r\n//\r\n\r\nconst _matrix = new THREE.Matrix4();\r\nconst _matrix2 = new THREE.Matrix4();\r\n\r\nclass CSS3DRenderer {\r\n  constructor() {\r\n    const _this = this;\r\n\r\n    let _width, _height;\r\n    let _widthHalf, _heightHalf;\r\n\r\n    const cache = {\r\n      camera: { fov: 0, style: '' },\r\n      objects: new WeakMap(),\r\n    };\r\n\r\n    const domElement = document.createElement('div');\r\n    domElement.style.overflow = 'hidden';\r\n\r\n    this.domElement = domElement;\r\n\r\n    const cameraElement = document.createElement('div');\r\n\r\n    cameraElement.style.transformStyle = 'preserve-3d';\r\n    cameraElement.style.pointerEvents = 'none';\r\n\r\n    domElement.appendChild(cameraElement);\r\n\r\n    this.getSize = function () {\r\n      return {\r\n        width: _width,\r\n        height: _height,\r\n      };\r\n    };\r\n\r\n    this.render = function (scene, camera) {\r\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf;\r\n\r\n      if (cache.camera.fov !== fov) {\r\n        domElement.style.perspective = camera.isPerspectiveCamera ? fov + 'px' : '';\r\n        cache.camera.fov = fov;\r\n      }\r\n\r\n      if (scene.autoUpdate === true) scene.updateMatrixWorld();\r\n      if (camera.parent === null) camera.updateMatrixWorld();\r\n\r\n      let tx, ty;\r\n\r\n      if (camera.isOrthographicCamera) {\r\n        tx = -(camera.right + camera.left) / 2;\r\n        ty = (camera.top + camera.bottom) / 2;\r\n      }\r\n\r\n      const cameraCSSMatrix = camera.isOrthographicCamera\r\n        ? 'scale(' +\r\n          fov +\r\n          ')' +\r\n          'translate(' +\r\n          epsilon(tx) +\r\n          'px,' +\r\n          epsilon(ty) +\r\n          'px)' +\r\n          getCameraCSSMatrix(camera.matrixWorldInverse)\r\n        : 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse);\r\n\r\n      const style = cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)';\r\n\r\n      if (cache.camera.style !== style) {\r\n        cameraElement.style.transform = style;\r\n\r\n        cache.camera.style = style;\r\n      }\r\n\r\n      renderObject(scene, scene, camera, cameraCSSMatrix);\r\n    };\r\n\r\n    this.setSize = function (width, height) {\r\n      _width = width;\r\n      _height = height;\r\n      _widthHalf = _width / 2;\r\n      _heightHalf = _height / 2;\r\n\r\n      domElement.style.width = width + 'px';\r\n      domElement.style.height = height + 'px';\r\n\r\n      cameraElement.style.width = width + 'px';\r\n      cameraElement.style.height = height + 'px';\r\n    };\r\n\r\n    function epsilon(value) {\r\n      return Math.abs(value) < 1e-10 ? 0 : value;\r\n    }\r\n\r\n    function getCameraCSSMatrix(matrix) {\r\n      const elements = matrix.elements;\r\n\r\n      return (\r\n        'matrix3d(' +\r\n        epsilon(elements[0]) +\r\n        ',' +\r\n        epsilon(-elements[1]) +\r\n        ',' +\r\n        epsilon(elements[2]) +\r\n        ',' +\r\n        epsilon(elements[3]) +\r\n        ',' +\r\n        epsilon(elements[4]) +\r\n        ',' +\r\n        epsilon(-elements[5]) +\r\n        ',' +\r\n        epsilon(elements[6]) +\r\n        ',' +\r\n        epsilon(elements[7]) +\r\n        ',' +\r\n        epsilon(elements[8]) +\r\n        ',' +\r\n        epsilon(-elements[9]) +\r\n        ',' +\r\n        epsilon(elements[10]) +\r\n        ',' +\r\n        epsilon(elements[11]) +\r\n        ',' +\r\n        epsilon(elements[12]) +\r\n        ',' +\r\n        epsilon(-elements[13]) +\r\n        ',' +\r\n        epsilon(elements[14]) +\r\n        ',' +\r\n        epsilon(elements[15]) +\r\n        ')'\r\n      );\r\n    }\r\n\r\n    function getObjectCSSMatrix(matrix) {\r\n      const elements = matrix.elements;\r\n      const matrix3d =\r\n        'matrix3d(' +\r\n        epsilon(elements[0]) +\r\n        ',' +\r\n        epsilon(elements[1]) +\r\n        ',' +\r\n        epsilon(elements[2]) +\r\n        ',' +\r\n        epsilon(elements[3]) +\r\n        ',' +\r\n        epsilon(-elements[4]) +\r\n        ',' +\r\n        epsilon(-elements[5]) +\r\n        ',' +\r\n        epsilon(-elements[6]) +\r\n        ',' +\r\n        epsilon(-elements[7]) +\r\n        ',' +\r\n        epsilon(elements[8]) +\r\n        ',' +\r\n        epsilon(elements[9]) +\r\n        ',' +\r\n        epsilon(elements[10]) +\r\n        ',' +\r\n        epsilon(elements[11]) +\r\n        ',' +\r\n        epsilon(elements[12]) +\r\n        ',' +\r\n        epsilon(elements[13]) +\r\n        ',' +\r\n        epsilon(elements[14]) +\r\n        ',' +\r\n        epsilon(elements[15]) +\r\n        ')';\r\n\r\n      return 'translate(-50%,-50%)' + matrix3d;\r\n    }\r\n\r\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\r\n      if (object.isCSS3DObject) {\r\n        object.onBeforeRender(_this, scene, camera);\r\n\r\n        let style;\r\n\r\n        if (object.isCSS3DSprite) {\r\n          // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\r\n\r\n          _matrix.copy(camera.matrixWorldInverse);\r\n          _matrix.transpose();\r\n\r\n          if (object.rotation2D !== 0) _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D));\r\n\r\n          _matrix.copyPosition(object.matrixWorld);\r\n          _matrix.scale(object.scale);\r\n\r\n          _matrix.elements[3] = 0;\r\n          _matrix.elements[7] = 0;\r\n          _matrix.elements[11] = 0;\r\n          _matrix.elements[15] = 1;\r\n\r\n          style = getObjectCSSMatrix(_matrix);\r\n        } else {\r\n          style = getObjectCSSMatrix(object.matrixWorld);\r\n        }\r\n\r\n        const element = object.element;\r\n        const cachedObject = cache.objects.get(object);\r\n\r\n        if (cachedObject === undefined || cachedObject.style !== style) {\r\n          element.style.transform = style;\r\n\r\n          const objectData = { style: style };\r\n          cache.objects.set(object, objectData);\r\n        }\r\n\r\n        element.style.display = object.visible ? '' : 'none';\r\n\r\n        if (element.parentNode !== cameraElement) {\r\n          cameraElement.appendChild(element);\r\n        }\r\n\r\n        object.onAfterRender(_this, scene, camera);\r\n      }\r\n\r\n      for (let i = 0, l = object.children.length; i < l; i++) {\r\n        renderObject(object.children[i], scene, camera, cameraCSSMatrix);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer };\r\n","/**\r\n * Useful for projecting to scale high-resolution DOM elements\r\n */\r\nexport const cssFactor = 100;\r\n","import { CSS3DRenderer } from './lib/CSS3DRenderer';\r\nimport { cssFactor } from './constants';\r\nexport class DOMContext {\r\n  /**\r\n   * DOM context instance\r\n   * @param camera  A perspective camera instance to draw from\r\n   */\r\n  constructor(camera, websurfaceEntity) {\r\n    this.websurfaceEntity = websurfaceEntity;\r\n    // Set default settings\r\n    this.enabled = true;\r\n    // Init renderer\r\n    this.cssRenderer = new CSS3DRenderer();\r\n    this.domElement = this.cssRenderer.domElement;\r\n    this.domElement.style.position = 'fixed';\r\n    this.domElement.style.zIndex = '-2';\r\n    // Init camera\r\n    this.cssCamera = new THREE.PerspectiveCamera(\r\n      camera.fov,\r\n      camera.aspect,\r\n      camera.near * cssFactor,\r\n      camera.far * cssFactor\r\n    );\r\n    this.camera = camera;\r\n    // Init scene\r\n    this.cssScene = new THREE.Scene();\r\n    // Bind update\r\n    this.update = this.update.bind(this);\r\n  }\r\n  /**\r\n   * Resizes the DOM context's renderer and camera\r\n   * @param width Target width\r\n   * @param height Target height\r\n   */\r\n  setSize(width, height) {\r\n    this.cssRenderer.setSize(width, height);\r\n    this.cssCamera.aspect = width / height;\r\n    this.cssCamera.updateProjectionMatrix();\r\n  }\r\n  /**\r\n   * Updates the DOM context's renderer and camera states\r\n   */\r\n  update() {\r\n    // Sync CSS camera with WebGL camera\r\n    this.camera.getWorldPosition(this.cssCamera.position);\r\n    this.cssCamera.position.multiplyScalar(cssFactor);\r\n    this.camera.getWorldQuaternion(this.cssCamera.quaternion);\r\n\r\n    // Render projection\r\n    this.cssRenderer.render(this.cssScene, this.cssCamera);\r\n  }\r\n}\r\n","import { CSS3DObject } from './lib/CSS3DRenderer';\r\nimport { cssFactor } from './constants';\r\nexport class DOMElement extends THREE.Mesh {\r\n  /**\r\n   * DOM element that is projected into 3D space\r\n   * @param context A DOM context instance to draw on\r\n   * @param domElement A DOM element to project\r\n   * @param options DOM element options\r\n   * @param options.elementWidth DOM element width\r\n   * @param options.width 3D plane width\r\n   * @param options.height 3D plane height\r\n   */\r\n  constructor(context, domElement, width, height, { elementWidth = 1280 } = {}) {\r\n    // Create portal mesh\r\n    const geometry = new THREE.PlaneGeometry(width, height);\r\n    const material = new THREE.MeshBasicMaterial({\r\n      opacity: 0,\r\n      blending: THREE.NoBlending,\r\n      side: THREE.DoubleSide,\r\n      color: new THREE.Color(0, 0, 0),\r\n    });\r\n    super(geometry, material);\r\n    // Expose params\r\n    this.context = context;\r\n    this.domElement = domElement;\r\n    this.aspectRatio = height / width;\r\n    this.elementWidth = elementWidth;\r\n    this.elementHeight = this.elementWidth * this.aspectRatio;\r\n    this.width = width;\r\n    this.height = height;\r\n    // Set initial size\r\n    this.resizeElement();\r\n    // Init 3D DOM\r\n    this.cssObject = new CSS3DObject(this.domElement);\r\n    this.cssObject.scale.multiplyScalar(cssFactor / (this.elementWidth / this.width));\r\n    //@custom\r\n    this.cssObjectInitialScale = this.cssObject.scale;\r\n    // Init helpers\r\n    this.size = new THREE.Vector3();\r\n    this.box = new THREE.Box3();\r\n    // Init events\r\n    this.addEventListener('added', this.handleAdded);\r\n    this.addEventListener('removed', this.handleRemoved);\r\n    // Bind update\r\n    this.update = this.update.bind(this);\r\n  }\r\n  /**\r\n   * Adds the current cssObject to the scene\r\n   */\r\n  handleAdded() {\r\n    this.context.cssScene.add(this.cssObject);\r\n  }\r\n  /**\r\n   * Removes the current cssObject from the scene\r\n   */\r\n  handleRemoved() {\r\n    this.context.cssScene.remove(this.cssObject);\r\n  }\r\n  /**\r\n   * Resizes DOM element to sync with projection\r\n   */\r\n  resizeElement() {\r\n    this.domElement.style.width = `${this.elementWidth}px`;\r\n    this.domElement.style.height = `${this.elementHeight}px`;\r\n  }\r\n  /**\r\n   * Updates the projected DOM element\r\n   * @param domElement A DOM element to project\r\n   */\r\n  setElement(domElement) {\r\n    // Cleanup previous element\r\n    if (this.domElement.parentNode) {\r\n      this.domElement.parentNode.removeChild(this.domElement);\r\n    }\r\n    // Set new element\r\n    this.domElement = domElement;\r\n    this.cssObject.element = domElement;\r\n    // Reset element size\r\n    this.resizeElement();\r\n  }\r\n  /**\r\n   * Updates the DOM element and its projection states\r\n   */\r\n  //@custom\r\n  update(obj) {\r\n    // Sync CSS properties with WebGL mesh\r\n    this.cssObject.quaternion.copy(obj.quaternion);\r\n    this.cssObject.position.copy(obj.position).multiplyScalar(cssFactor);\r\n    // Calculate CSS scale factor\r\n    this.box.setFromObject(this).getSize(this.size);\r\n    const scaleFactor = obj.scale;\r\n    // Sync CSS scale with WebGL projection\r\n    if (this.oldScaleFactor != scaleFactor) {\r\n      this.oldScaleFactor = scaleFactor;\r\n      this.cssObject.scale.set(\r\n        this.cssObjectInitialScale.x,\r\n        this.cssObjectInitialScale.y,\r\n        this.cssObjectInitialScale.z\r\n      );\r\n      this.cssObject.scale.multiply(scaleFactor);\r\n    }\r\n    this.cssObject.visible = obj.visible;\r\n  }\r\n  /**\r\n   * Disposes WebGL and DOM elements\r\n   */\r\n  dispose() {\r\n    // Cleanup events\r\n    this.removeEventListener('added', this.handleAdded);\r\n    this.removeEventListener('removed', this.handleRemoved);\r\n    // Cleanup DOM\r\n    this.domElement.remove();\r\n    // Cleanup WebGL\r\n    this.geometry.dispose();\r\n    this.material.dispose();\r\n  }\r\n}\r\n","//uses a modified version of https://github.com/CodyJasonBennett/three-dom-elements\r\nimport { DOMContext } from './DOMContext';\r\nimport { DOMElement } from './DOMElement';\r\nexport const component = AFRAME.registerComponent('websurface', {\r\n  schema: {\r\n    url: { default: 'https://aframe.io' },\r\n    width: { default: 1 },\r\n    height: { default: 0.75 },\r\n    isInteractable: { default: true },\r\n    frameSkips: { default: 1 },\r\n    autoSceneStyling: { default: true },\r\n  },\r\n\r\n  init: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    if (data.autoSceneStyling == true) {\r\n      el.sceneEl.style.position = 'absolute';\r\n      el.sceneEl.style.zIndex = '1';\r\n    }\r\n\r\n    if (data.isInteractable == true) {\r\n      data.mouseHasLeftScreen = true;\r\n      //geometry for click detection\r\n      el.setAttribute('geometry', `primitive:plane; width:${data.width}; height:${data.height};`);\r\n\r\n      el.addEventListener('click', function () {\r\n        if (data.mouseHasLeftScreen == false) return;\r\n        document.exitPointerLock();\r\n        el.sceneEl.style.zIndex = '-1';\r\n        data.mouseHasLeftScreen = false;\r\n      });\r\n\r\n      el.addEventListener('mouseenter', function () {\r\n        data.context.domElement.style.zIndex = '0';\r\n      });\r\n\r\n      el.addEventListener('mouseleave', function () {\r\n        data.context.domElement.style.zIndex = '-2';\r\n        data.mouseHasLeftScreen = true;\r\n      });\r\n    }\r\n\r\n    el.addEventListener('cam-loaded', function () {\r\n      const iframe = document.createElement('iframe');\r\n      iframe.setAttribute('src', data.url);\r\n      iframe.style.border = 'none';\r\n\r\n      const camera = el.sceneEl.camera;\r\n      const context = new DOMContext(camera, el);\r\n      context.setSize(window.innerWidth, window.innerHeight);\r\n      document.body.appendChild(context.domElement);\r\n\r\n      const element = new DOMElement(context, iframe, data.width, data.height);\r\n      el.object3D.add(element);\r\n\r\n      if (data.isInteractable == true) {\r\n        const div = document.createElement('div');\r\n        div.style.position = 'fixed';\r\n        div.style.top = '0';\r\n        div.style.width = '100%';\r\n        div.style.height = '100%';\r\n        div.style.zIndex = '-1';\r\n        context.domElement.appendChild(div);\r\n        div.addEventListener('click', function () {\r\n          el.sceneEl.style.zIndex = 1;\r\n        });\r\n      }\r\n\r\n      this.websurface_iframe = iframe;\r\n      this.css3d_context = context;\r\n\r\n      data.context = context;\r\n      data.element = element;\r\n\r\n      window.addEventListener('resize', () => {\r\n        context.setSize(window.innerWidth, window.innerHeight);\r\n      });\r\n    });\r\n    data.frames = 0;\r\n    data.isCamLoaded = false;\r\n  },\r\n\r\n  tick: function () {\r\n    const el = this.el;\r\n    const data = this.data;\r\n\r\n    if (data.isPaused == true) return;\r\n\r\n    if (data.isCamLoaded == false) {\r\n      const camera = el.sceneEl.camera;\r\n      if (camera) {\r\n        this.el.emit('cam-loaded');\r\n        data.isCamLoaded = true;\r\n      }\r\n      return;\r\n    }\r\n\r\n    const context = data.context;\r\n    const element = data.element;\r\n    if (data.frames % data.frameSkips == 0) {\r\n      if (context) {\r\n        context.update();\r\n      }\r\n      if (element) {\r\n        element.update(el.object3D);\r\n      }\r\n    }\r\n\r\n    data.frames++;\r\n  },\r\n\r\n  pause: function () {\r\n    const data = this.data;\r\n\r\n    data.isPaused = true;\r\n  },\r\n\r\n  play: function () {\r\n    const data = this.data;\r\n\r\n    data.isPaused = false;\r\n  },\r\n});\r\n"],"names":["CSS3DObject","element","_this2","document","createElement","style","position","pointerEvents","addEventListener","this","traverse","object","Element","parentNode","removeChild","copy","source","recursive","_THREE$Object3D","cloneNode","THREE","Object3D","prototype","isCSS3DObject","_this3","rotation2D","_CSS3DObject","isCSS3DSprite","_matrix","Matrix4","_matrix2","CSS3DRenderer","_width","_height","_widthHalf","_heightHalf","_this","cache","camera","fov","objects","WeakMap","domElement","overflow","cameraElement","epsilon","value","Math","abs","getCameraCSSMatrix","matrix","elements","getObjectCSSMatrix","renderObject","scene","cameraCSSMatrix","onBeforeRender","matrixWorldInverse","transpose","multiply","makeRotationZ","copyPosition","matrixWorld","scale","cachedObject","get","undefined","transform","set","display","visible","appendChild","onAfterRender","i","l","children","length","transformStyle","getSize","width","height","render","tx","ty","projectionMatrix","perspective","isPerspectiveCamera","autoUpdate","updateMatrixWorld","parent","isOrthographicCamera","right","left","top","bottom","setSize","cssFactor","DOMContext","websurfaceEntity","enabled","cssRenderer","zIndex","cssCamera","PerspectiveCamera","aspect","near","far","cssScene","Scene","update","bind","updateProjectionMatrix","getWorldPosition","multiplyScalar","getWorldQuaternion","quaternion","DOMElement","context","elementWidth","geometry","PlaneGeometry","material","MeshBasicMaterial","opacity","blending","NoBlending","side","DoubleSide","color","Color","aspectRatio","elementHeight","resizeElement","cssObject","cssObjectInitialScale","size","Vector3","box","Box3","handleAdded","handleRemoved","add","remove","setElement","obj","setFromObject","scaleFactor","oldScaleFactor","x","y","z","dispose","removeEventListener","Mesh","component","AFRAME","registerComponent","schema","url","default","isInteractable","frameSkips","autoSceneStyling","init","el","data","sceneEl","mouseHasLeftScreen","setAttribute","exitPointerLock","iframe","border","window","innerWidth","innerHeight","body","object3D","div","websurface_iframe","css3d_context","frames","isCamLoaded","tick","isPaused","emit","pause","play"],"mappings":"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"}